<h2 class="text-center" style="padding: 10px;" id="head"></h2>
<table class="table table-hover" style="width: 50%; margin: auto;">
    <tbody id="tb">
        <tr>
            <td>ID</td>
            <td id="idSvd"></td>
        </tr>
        <tr>
            <td>Name</td>
            <td id="name"></td>
        </tr>
        <tr>
            <td>Capacity</td>
            <td id="capacity"></td>
        </tr>
        <tr>
            <td>Status</td>
            <td id="status"></td>
        </tr>
        <tr>
            <td>Type</td>
            <td id="type"></td>
        </tr>
        <tr>
            <td>Price</td>
            <td id="price"></td>
        </tr>

    </tbody>
</table>
<div class="text-center">
    <a href="/listSvd"><button class="btn btn-light">Back</button></a>
    <% if(locals.position === 2){ %>
        <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#myModal">Update</button>

    <% } %>
            <div id="mess" style="color: green;"></div>
</div>

<div class="modal" id="myModal">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Update</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <table class="table table-hover">
                    <tbody id="tb">
                        <tr>
                            <td>ID</td>
                            <td id="idSvd_MD"></td>
                        </tr>
                        <tr>
                            <td>Name</td>
                            <td id="name_MD"></td>
                        </tr>
                        <tr>
                            <td>Capacity</td>
                            <td><input id="capacity_MD" type="number"></td>
                        </tr>
                        <tr>
                            <td>Status</td>
                            <td>
                                <select name="status" id="status_MD">
                                    <option value="0">empty</option>
                                    <option value="1">ordered</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>Type</td>
                            <td>
                                <select name="type" id="type_MD">
                                    <option value="0">Normal</option>
                                    <option value="1">VIP</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>Price</td>
                            <td><input type="number" id="price_MD"></td>
                        </tr>

                    </tbody>
                </table>
                <div class="text-center" style="color: red;" id="err"></div>
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button id="btn_update" type="button" class="btn btn-light">Update</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
</div>

<script>
    var btn_update = document.getElementById('btn_update')
    var url = new URL(window.location)
    var idSvd = url.searchParams.get('idSvd')

    fetch('/getSvd/' + idSvd + "?token=<%= token %>", {
        method: "GET",
        headers: {
            'Content-Type': 'application/json'
        },
    })
        .then(req => req.json())
        .then(json => {
            if (json.code === 0) {
                data = json.data[0]
                var idSvd = document.getElementById('idSvd')
                var name = document.getElementById('name')
                var type = document.getElementById('type')
                var price = document.getElementById('price')
                var capacity = document.getElementById('capacity')
                var status = document.getElementById('status')

                idSvd.innerHTML = data.idSvd
                name.innerHTML = data.name
                if (data.type == 1)
                    type.innerHTML = "VIP"
                else
                    type.innerHTML = "normal"
                if (data.status === 0)
                    status.innerHTML = "empty"
                else
                    status.innerHTML = "ordered"
                price.innerHTML = data.price.toLocaleString('vi', { style: 'currency', currency: 'VND' }) + "/h"
                capacity.innerHTML = data.capacity + " people"

                document.getElementById('head').innerHTML = data.idSvd

                var idSvd_MD = document.getElementById('idSvd_MD')
                var name_MD = document.getElementById('name_MD')
                var price_MD = document.getElementById('price_MD')
                var capacity_MD = document.getElementById('capacity_MD')

                idSvd_MD.innerHTML = data.idSvd
                name_MD.innerHTML = data.name
                capacity_MD.value = data.capacity
                price_MD.value = data.price
            }
        })
        .catch(e => console.log(e))

    btn_update.addEventListener("click", () => {
        document.getElementById('err').innerHTML = ""
        var idSvd_MD = document.getElementById('idSvd_MD').innerHTML
        var price_MD = document.getElementById('price_MD').value
        var capacity_MD = document.getElementById('capacity_MD').value
        var type_MD = document.getElementById('type_MD').value
        var status_MD = document.getElementById('status_MD').value

        if (idSvd_MD && price_MD && capacity_MD && type_MD && status_MD) {
            fetch('/updateSvd', {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    idSvd: idSvd_MD,
                    type: type_MD,
                    capacity: capacity_MD,
                    status: status_MD,
                    price: price_MD,
                    token: "<%= token %>"
                })
            })
                .then(res => res.json())
                .then(json => {
                    if (json.code === 0) {
                        return window.location.href = ''
                    }
                    else
                        document.getElementById('err').innerHTML = "update fail!"
                })
                .catch(err => console.log(err))
        }
        else
            document.getElementById('err').innerHTML = "please check infomation again"

    })
</script>