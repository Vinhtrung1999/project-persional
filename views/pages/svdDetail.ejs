<!-- css -->
<link rel="stylesheet" href="/css/svdDetail.css">

<h2 class="text-center" style="padding: 10px;" id="head"></h2>

<div class="block-container">
    <div class="block-container-title">
        <div class="block-container-title-img">
            <img id="img-type-svd" src="https://cdn-icons-png.flaticon.com/512/31/31834.png" alt="NM" width="80px" height="80px">
        </div>
        <div class="">
            <% if(locals.position === 2){ %>
                <button class="btn-custom f-1-2 bg-green cl-white p-10 m-10">
                    <i class="fa-solid fa-pen-to-square"></i>
                </button>

                <button class="btn-custom f-1-2 bg-red cl-white p-10 m-10">
                    <i class="fa-solid fa-trash-can"></i>
                </button>
                <% } %>
        </div>
    </div>
    <div class="block-container-body">
        <div class="body-items">
            <div class="body-items-title">ID</div>
            <div class="body-items-content" id="idSvd"></div>
        </div>
        <div class="body-items">
            <div class="body-items-title">Name</div>
            <div class="body-items-content" id="name"></div>
        </div>
        <div class="body-items">
            <div class="body-items-title">Capacity</div>
            <div class="body-items-content" id="capacity"></div>
        </div>
        <div class="body-items">
            <div class="body-items-title">Status</div>
            <div class="body-items-content" id="status"></div>
        </div>
        <div class="body-items">
            <div class="body-items-title">Type</div>
            <div class="body-items-content" id="type"></div>
        </div>
        <div class="body-items">
            <div class="body-items-title">Price</div>
            <div class="body-items-content" id="price"></div>
        </div>
        <div class="t-end">
            <a href="/svd/listSvd">
                <button class="btn-custom f-1-2">
                    <i class="fa-solid fa-arrow-right-from-bracket"></i>
                </button>
            </a>
        </div>
        <div id="mess" class="success"><%= locals.mess %></div>
    </div>
</div>

<div class="modal" id="myModal">
    <div class="modal-content p-10">
        <!-- Modal Header -->
        <div class="modal-header t-center">
            <img id="img-type-svd" src="https://cdn-icons-png.flaticon.com/512/31/31834.png" alt="NM" width="80px" height="80px">
        </div>

        <!-- Modal body -->
        <div class="modal-body">
            <div class="modal-body-item">
                <div class="modal-body-item-title">ID</div>
                <div class="modal-body-item-content" id="idSvd_MD">ID</div>
            </div>

            <div class="modal-body-item">
                <div class="modal-body-item-title">ID</div>
                <div class="modal-body-item-content" id="idSvd_MD">ID</div>
            </div>

            <div class="modal-body-item">
                <div class="modal-body-item-title">name</div>
                <div class="modal-body-item-content" id="name_MD">ID</div>
            </div>

            <div class="modal-body-item">
                <div class="modal-body-item-title">Capacity</div>
                <div class="modal-body-item-content">
                    <input id="capacity_MD" type="number">
                </div>
            </div>

            <div class="modal-body-item">
                <div class="modal-body-item-title">Status</div>
                <div class="modal-body-item-content">
                    <select name="status" id="status_MD">
                        <option value="0">empty</option>
                        <option value="1">ordered</option>
                    </select>
                </div>
            </div>

            <div class="modal-body-item">
                <div class="modal-body-item-title">Type</div>
                <div class="modal-body-item-content">
                    <select name="type" id="type_MD">
                        <option value="0">Normal</option>
                        <option value="1">VIP</option>
                    </select>
                </div>
            </div>

            <div class="modal-body-item">
                <div class="modal-body-item-title">Price</div>
                <div class="modal-body-item-content">
                    <input type="number" id="price_MD">
                </div>
            </div>

            <div class="err" id="err"></div>
        </div>

        <!-- Modal footer -->
        <div class="modal-footer">
            <button id="btn_update" type="button" class="btn btn-light">Update</button>
            <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        </div>

    </div>

</div>

<script>
    var btn_update = document.getElementById('btn_update')
    var url = new URL(window.location)
    var idSvd = url.searchParams.get('idSvd')

    fetch('/getSvd/' + idSvd + "?token=<%= token %>", {
        method: "GET",
        headers: {
            'Content-Type': 'application/json'
        },
    })
        .then(req => req.json())
        .then(json => {
            if (json.code === 0) {
                data = json.data[0]
                let idSvd = document.getElementById('idSvd')
                let name = document.getElementById('name')
                let type = document.getElementById('type')
                let price = document.getElementById('price')
                let capacity = document.getElementById('capacity')
                let status = document.getElementById('status')
                let img_type_svd = document.getElementById('img-type-svd')

                idSvd.innerHTML = data.idSvd
                name.innerHTML = data.name
                if (data.type == 1){
                    type.innerHTML = "VIP"
                    img_type_svd.setAttribute('src', 'https://cdn-icons-png.flaticon.com/512/637/637088.png')
                }
                else{
                    type.innerHTML = "normal"
                    img_type_svd.setAttribute('src', 'https://cdn-icons-png.flaticon.com/512/31/31834.png')
                }
                    
                if (data.status === 0)
                    status.innerHTML = "empty"
                else
                    status.innerHTML = "ordered"
                price.innerHTML = data.price.toLocaleString('vi', { style: 'currency', currency: 'VND' }) + "/h"
                capacity.innerHTML = data.capacity + " people"

                document.getElementById('head').innerHTML = data.idSvd

                var idSvd_MD = document.getElementById('idSvd_MD')
                var name_MD = document.getElementById('name_MD')
                var price_MD = document.getElementById('price_MD')
                var capacity_MD = document.getElementById('capacity_MD')

                idSvd_MD.innerHTML = data.idSvd
                name_MD.innerHTML = data.name
                capacity_MD.value = data.capacity
                price_MD.value = data.price
            }
        })
        .catch(e => console.log(e))

    btn_update.addEventListener("click", () => {
        document.getElementById('err').innerHTML = ""
        var idSvd_MD = document.getElementById('idSvd_MD').innerHTML
        var price_MD = document.getElementById('price_MD').value
        var capacity_MD = document.getElementById('capacity_MD').value
        var type_MD = document.getElementById('type_MD').value
        var status_MD = document.getElementById('status_MD').value

        if (idSvd_MD && price_MD && capacity_MD && type_MD && status_MD) {
            fetch('/updateSvd', {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    idSvd: idSvd_MD,
                    type: type_MD,
                    capacity: capacity_MD,
                    status: status_MD,
                    price: price_MD,
                    token: "<%= token %>"
                })
            })
                .then(res => res.json())
                .then(json => {
                    console.log(json)
                    if (json.code === 0) {
                        return window.location.href = `/svd/svdDetail?idSvd=${idSvd_MD}&mess=Update ${idSvd_MD} success`
                    }
                    else
                        document.getElementById('err').innerHTML = "update fail!"
                })
                .catch(err => console.log(err))
        }
        else
            document.getElementById('err').innerHTML = "please check infomation again"

    })
</script>