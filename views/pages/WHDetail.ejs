<h2 class="text-center" style="padding: 10px;" id="head"></h2>
<table class="table table-hover" style="width: 50%; margin: auto;">
    <tbody id="tb">
        <tr>
            <td>ID</td>
            <td id="idProWH"></td>
        </tr>
        <tr>
            <td>Name</td>
            <td id="name"></td>
        </tr>
        <tr>
            <td>Type</td>
            <td id="type"></td>
        </tr>
        <tr>
            <td>Quantity</td>
            <td id="qty"></td>
        </tr>
        <tr>
            <td>Price</td>
            <td id="price"></td>
        </tr>
        <tr>
            <td>Price input</td>
            <td id="priceInput"></td>
        </tr>
        <tr>
            <td>Date input</td>
            <td id="date"></td>
        </tr>
    </tbody>
</table>
<div class="text-center">
    <a href="/listWH"><button class="btn btn-dark">Back</button></a>
    <% if(locals.position === 2){ %>
        <button type="button" class="btn btn-info" data-toggle="modal" data-target="#myModal">Update</button>
    <% } %>
    <button class="btn btn-danger" id="btn_delete">Delete</button>
</div>

<div class="modal" id="myModal">
    <div class="modal-dialog">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Update</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
        <!-- Modal body -->
        <div class="modal-body">
            <table class="table table-hover">
                <tbody id="tb">
                    <tr>
                        <td>ID</td>
                        <td id="idProWH_MD"></td>
                    </tr>
                    <tr>
                        <td>Price</td>
                        <td><input type="number" name="" id="price_MD"></td>
                    </tr>            
                </tbody>
            </table>
            <div class="text-center" style="color: red;" id="err"></div>
        </div>
        
        <!-- Modal footer -->
        <div class="modal-footer">
            <button id="btn_update" type="button" class="btn btn-light">Update</button>
            <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        </div>
        
      </div>
    </div>
  </div>



<script>
    var url = new URL(window.location)
    var idProWH = url.searchParams.get('idProWH')    


    fetch('/getProWH/'+idProWH+"?token=<%= token %>", {
        method: "GET",
        headers: {
            'Content-Type': 'application/json'
        },
    })
    .then(req => req.json())
    .then(json => {
        console.log(json)
        if(json.code === 0){
            data = json.data[0]
            console.log(data)
            var idProWH = document.getElementById('idProWH')
            var name = document.getElementById('name')
            var type = document.getElementById('type')
            var qty = document.getElementById('qty')
            var price = document.getElementById('price')
            var priceIn = document.getElementById('priceInput')
            var date = document.getElementById('date')

            idProWH.innerHTML = data.idProWH
            name.innerHTML = data.name
            qty.innerHTML = data.qty
            price.innerHTML = parseInt(data.price).toLocaleString('vi', {style : 'currency', currency : 'VND'})
            priceIn.innerHTML = parseInt(data.priceIn).toLocaleString('vi', {style : 'currency', currency : 'VND'})
            date.innerHTML = data.dateIn

            if(data.type === 0)
                type.innerHTML = "Drink"
            else if(data.type === 1)
                type.innerHTML = "Food"
            else
                type.innerHTML = "Item"

            document.getElementById('head').innerHTML = data.idProWH

            var idProWH_MD = document.getElementById('idProWH_MD')
            var price_MD = document.getElementById('price_MD')

            idProWH_MD.innerHTML = data.idProWH
            price_MD.value = data.price
        }  
    })
    .catch(e => console.log(e))

    var btn_update = document.getElementById('btn_update')

    btn_update.addEventListener("click", () => {
        document.getElementById('err').innerHTML = ""
        var idProWH_MD = document.getElementById('idProWH_MD').innerHTML
        var price_MD = document.getElementById('price_MD').value

        if(idProWH_MD && price_MD)
        {
            fetch('/updatePriceProWH', {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    token : "<%= token %>",
                    idProWH : idProWH_MD,
                    price : price_MD
                })
            })
            .then(res => res.json())
            .then(json => {
                if(json.code === 0)
                    return window.location.href = ""
                else
                    document.getElementById('err').innerHTML = "update fail"
            })
        }else
            document.getElementById('err').innerHTML = "please check information again"
    })

    var btn_delete = document.getElementById('btn_delete')

    btn_delete.addEventListener("click",() => {
        var url = new URL(window.location)
        var idProWH = url.searchParams.get('idProWH')  

        fetch('/deleteWH', {
            method: "DELETE",
            headers: {
                'Content-Type': 'application/json'
            },
            body : JSON.stringify({
                token : "<%= token %>",
                idProWH : idProWH
            })
        })
        .then(req => req.json())
        .then(json => {
            if(json.code === 0){
                return window.location.href = "/listWH"
            }  
        })
        .catch(e => console.log(e))
    })
</script>